%!TEX root = main.tex

% Sampling Section of negFE

\section{Sampling Proceedure}
The sampling proceedure that we will use and discuss in this work is two fold.
There is first, a family of distributions that we will call $\mathcal{W}$. 
There is some finite number of distributions in this family, we call $|\mathcal{W}| = \mathcal{R}$. 
We let $Z$ be an index for the distributions in the family and we denote the $Z$th distribution $W_Z$. 
The distribution $W_Z$ can then be sampled, and we denote a sample of $W_Z$ as $w_{Z} \in \zeroone{n}$. When $Z$ is clear, we will omit the subscript.

To sample a uniform point in $\mathcal{W}$, we can uniformly select $Z$ and then pick from $W_Z$ unifromly. 
This two stage process gives us more tools to reason about the ability of an efficient adversary. 

In general, we will assume that $\mathcal{W}$ is public to any adversary, algorithm, or party we may discuss. 
We will generally assume that the specific selection of $Z$ is only shared with specific parties.
We will also assume that the specific $w$ sampled from $W_Z$ is private and only known to parties who are given it explicity. 

An interesting part of this work is how we share information about $W_Z$. We will allow an inefficient adversary access to the entire description of $W_Z$ and ask them to produce an advice string for an efficient adversary, that is that the advice string length is bound from above by a arbitrary polynomial function of our security parameter. 

\subsection{Distributions over $\zeroone{n}$}
\begin{description}
    \item[$U_{n,k}$] Picking $2^k$ points from $\zeroone{n}$ without replacement uniformly results in a distribution we will denote $U_{n,k}$. Note that there are ${2^{n}\choose 2^k}$ outcomes each occuring with probability $1/{2^{n}\choose 2^k}$.

%    \item[$U_{n,k,t}^{-}$] Another distribution of interest is picking $k$ points uniformly from $\zeroone{n}$ and then removing points that are within distance $t$ of one another, we denote this $U_{n,k,t}^{-}$. 
    \item[$\mathtt{Code}_{n,k,t}^{*}$] The set of all $2^k$ points where all points are distance $t$ from one another.  Note for all outcomes $X$ from this distribution $\Hfuzz(X) = \log k$.
    
    \item[$\mathtt{PCode}_{n, k, t, \alpha}^{*}$] The uniform distribution over all sets $X = \{x_i\}$ of size $2^k$ with the additional condition that $\Hfuzz(X) \ge \alpha$.  Note that this weakens the condition of $\mathtt{Code}$ above as some distributions are allowed to lie within distance $t$ as long as fewer than $2^{k-\alpha}$ do lie within a single ball of radius $t$.
\end{description}
 
 Before showing that $\mathtt{PCode}_{n, k, t, \alpha}^{*}$ is statistically close to $U_{n,k}$ we show a technical lemma about $U_{n,k}$ intersecting with a fixed set. 
  \begin{lemma}
  \label{lem:chernoff independence}
  Let $n,k,a$ be positive integers for which $\log a < k$.  Let $a^* = a/(1 - a2^{-k})$. Let $K$
  be a random variable uniform among all subsets of $\{0,1\}^n$ of
  size $2^k$. Let $A$ be a fixed subset of size $a \cdot 2^{n-k}$. Then
  $\Exp[|K \cap A|] = a$ and any $\zeta > 0$,
  \[
    \Pr[|K \cap A| \geq a^*(1 + \zeta)] \leq \left[\frac{e^\zeta}{(1+\zeta)^{1+\zeta}}\right]^{a^*}\,.
  \]
\end{lemma}
\begin{proof}
  For the purposes of bookkeeping, arrange the elements of $A$ in an
  arbitrary order and note that $|A| = a2^{n-k} < 2^k2^{n-k} = 2^n$ so $A\subset \{0,1\}^n$, and let
  \[
    X_1, \ldots, X_{a2^{n-k}}
  \]
  be indicator random variables so that $X_i = 1$ if and only if the
  $i$th element of $A$ lies in $K$.  Note that for any individual $i$, $\Pr[X_i =1] =a2^{n-k}/2^n = a2^{-k}$ and thus $\expe[|K\cap A|] =\sum_i \expe[X_i] = 2^k \expe[X_i] = a2^{-k}= a$ by linearity of expectation.  Observe that under any conditioning on the
  variables $X_1, \ldots, X_t$,
  \[
    \Pr[X_{t+1} = 1] \leq \frac{2^k}{2^n - a2^{n-k}} = \frac{2^k}{2^n(1 - a2^{-k})}\,.
  \]
   Let $Y_i$ be a sequence of
  i.i.d.\ random variables (with the same index set) for which
  \[
    \Pr[Y_i = 1] = \frac{2^{k}}{2^n(1 - a2^{-k})}\,.
  \]It follows that the random variable $\sum_i X_i$ is stochastically
  dominated by the random variable $\sum_i Y_i$. Observe that
  $\Exp[\sum Y_i] = a^*$. Applying a standard Chernoff upper tail
  bound to the $Y_i$ then yields the result.
\end{proof}

\begin{lemma}
 \label{lem:close family}
Let $n, k, t, \gamma$ be parameters such that $|B_t|/2^n\ge 2$ which is satisfied as long as $t< 1/2 $. Define \[2^\beta:=\frac{2^n-|B_t|}{|B_t|}\ge 1,\] then one has that 
\[\Delta(U_{n,k}, \mathtt{PCode}_{n, k, t, \gamma}^{*}) \le \left(e2^{\gamma-\beta}\right)^{2^{k-\gamma}}2^n.\]
\end{lemma}
\begin{proof}
It suffices to show that the number of items in the support of $U_{n,k}$ that are not in the support of $\mathtt{PCode}_{n, k, t, \gamma}^{*}$ is at most $\left(e2^{\gamma-\beta}\right)^{2^{k-\gamma}}2^n$ because both distributions are uniformly distributed over their support.  A distribution is not in $\mathtt{PCode}_{n, k, t, \gamma}^{*}$ if there exists some center $y$ such that there are at least $2^{-\gamma}2^k = 2^{k-\gamma}$ points within distance $t$ of $y$.  Fix some arbitrary $y^*$. The point $y^*$ defines a set $A_{y^*}$ of all points within distance $t$ and note that $|A_{y^*}| = |B_t|$.  Using the notation of Lemma~\ref{lem:chernoff independence}, let 
\[
a^* =\frac{2^k|B_t|}{2^n - |B_t|}=2^{k-\beta}.
\]
 the probability that an entry in $U_{n,k}$ intersects with $A_{y^*}$ in at least $2^{k-\gamma}$ places is at most 
\[
a^*(1+\zeta) = \frac{2^k|B_t|}{2^n - |B_t|}(1+\zeta) \ge 2^{k-\gamma}.
\]
Setting \[1+\zeta = \frac{2^{-\gamma}(2^n - |B_t|)}{|B_t|} \ge 2^{\beta-\gamma} \] yields that 
\[
\Pr[| U_{n,k} \cap A_{y^*} | \ge 2^{k-\gamma}] \le \left(\left(e2^{\gamma-\beta}\right)^{2^{\beta-\gamma}}\right)^{2^{k-\beta}} = \left(e2^{\gamma-\beta}\right)^{2^{k-\gamma}}
\]
Now we consider a union bound across all $y^*$ which is equivalent to asking the probability that $U_{n,k}$ has fuzzy min-entropy $\gamma$.  That is
\[
\Pr_{U\leftarrow U_{n,k}}[\Hfuzz(U)\ge \gamma] = \left(e2^{\gamma-\beta}\right)^{2^{k-\gamma}}2^n.
\]
\end{proof}

\paragraph{Parameter Analysis}

Let $c_1, c_2>0$ such that $c_1+c_2\ge 1$.  Then Lemma~\ref{lem:close family} is $\ngl(n)$ as long as 
\begin{align*}2^{\beta-\gamma}&\ge 2^{c_1n}e\\
2^{k-\gamma}&\ge c_2+\omega(\log n).
\end{align*}




