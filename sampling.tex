%!TEX root = main.tex

% Sampling Section of negFE
\begin{description}
    \item[$U_{n,k}$] Picking $2^k$ points from $\zeroone{n}$ without replacement uniformly results in a distribution we will denote $U_{n,k}$. Note that there are ${2^{n}\choose 2^k}$ outcomes each occuring with probability $1/{2^{n}\choose 2^k}$.

%    \item[$U_{n,k,t}^{-}$] Another distribution of interest is picking $k$ points uniformly from $\zeroone{n}$ and then removing points that are within distance $t$ of one another, we denote this $U_{n,k,t}^{-}$. 
%    \item[$\mathtt{Code}_{n,k,t}$] The set of all $2^k$ points where all points are distance $t$ from one another.  Note for all outcomes $X$ from this distribution $\Hfuzz(X) = \log k$.
    
    \item[$\mathtt{PCode}_{n, k, t, \alpha}$] The uniform distribution over all sets $X = \{x_i\}$ of size $2^k$ with the additional condition that $\Hfuzz(X) \ge \alpha$.  Some points are allowed to lie within distance $t$ as long as fewer than $2^{k-\alpha}$ lie within a single ball of radius $t$.
\end{description}
 
 \noindent
We show that $\mathtt{PCode}_{n, k, t, \alpha}$ is statistically close to $U_{n,k}$.

\begin{lemma}
 \label{lem:close family}
Let $n, k, t, \gamma$ be parameters such that the $\beta$ density is at least $0$ (which is satisfied as long as $t< n/2 $). Then one has that 
\[\Delta(U_{n,k}, \mathtt{PCode}_{n, k, t, \gamma}^{*}) \le \left(e2^{\gamma-\beta}\right)^{2^{k-\gamma}}2^n.\]
\end{lemma}
\begin{proof}
We begin by showing the fraction of items in the support of $U_{n,k}$ that are not in the support of $\mathtt{PCode}_{n, k, t, \gamma}^{*}$ is at most $\left(e2^{\gamma-\beta}\right)^{2^{k-\gamma}}2^n$.  That is, 
\[\Pr\left[U_{n,k} \not \in \mathtt{PCode}_{n, k, t, \alpha}\right] \le \left(e2^{\gamma-\beta}\right)^{2^{k-\gamma}}2^n
\]
A distribution is not in $\mathtt{PCode}_{n, k, t, \gamma}^{*}$ if there exists some center $y$ such that there are at least $2^{-\gamma}2^k = 2^{k-\gamma}$ points within distance $t$ of $y$.  Fix some arbitrary $y^*$. The point $y^*$ defines a set $A_{y^*}$ of all points within distance $t$ and note that $|A_{y^*}| = |B_t|$.  We now show that the probability that values in $U_{n,k}$ has a large intersection with $A_{y^*}$ is small.  

  \begin{lemma}
  \label{lem:chernoff independence}
  Let $n,k,a$ be positive integers for which $\log a < k$.  Let $a^* = a/(1 - a2^{-k})$. Let $K$
  be a random variable uniform among all subsets of $\{0,1\}^n$ of
  size $2^k$. Let $A$ be a fixed subset of size $a \cdot 2^{n-k}$. Then
  $\Exp[|K \cap A|] = a$ and any $\zeta > 0$,
  \[
    \Pr[|K \cap A| \geq a^*(1 + \zeta)] \leq \left[\frac{e^\zeta}{(1+\zeta)^{1+\zeta}}\right]^{a^*}\,.
  \]
\end{lemma}
\begin{proof}
  For the purposes of bookkeeping, arrange the elements of $A$ in an
  arbitrary order and note that $|A| = a2^{n-k} < 2^k2^{n-k} = 2^n$ so $A\subset \{0,1\}^n$, and let
  \[
    X_1, \ldots, X_{a2^{n-k}}
  \]
  be indicator random variables so that $X_i = 1$ if and only if the
  $i$th element of $A$ lies in $K$.  Note that for any individual $i$, $\Pr[X_i =1] =a2^{n-k}/2^n = a2^{-k}$ and thus $\expe[|K\cap A|] =\sum_i \expe[X_i] = 2^k \expe[X_i] =2^k (a2^{-k})= a$ by linearity of expectation.  Observe that under any conditioning on the
  variables $X_1, \ldots, X_t$,
  \[
    \Pr[X_{t+1} = 1] \leq \frac{2^k}{2^n - a2^{n-k}} = \frac{2^k}{2^n(1 - a2^{-k})}\,.
  \]
   Let $Y_i$ be a sequence of
  i.i.d.\ random variables (with the same index set) for which
  \[
    \Pr[Y_i = 1] = \frac{2^{k}}{2^n(1 - a2^{-k})}\,.
  \]It follows that the random variable $\sum_i X_i$ is stochastically
  dominated by the random variable $\sum_i Y_i$. Observe that
  $\Exp[\sum Y_i] = a^*$. Applying a standard Chernoff upper tail
  bound to the $Y_i$ then yields the result. This completes the proof of Lemma~\ref{lem:chernoff independence}.
\end{proof}

\noindent
We now continue using the notation of Lemma~\ref{lem:chernoff independence}, let 
\[
a^* =\frac{2^k|B_t|}{2^n - |B_t|}=2^{k-\beta}.
\]
Fix the value of $\zeta$ such that 
\[1+\zeta = \frac{2^{-\gamma}(2^n - |B_t|)}{|B_t|} \ge 2^{\beta-\gamma}. \]
then the probability that an entry in $U_{n,k}$ intersects with $A_{y^*}$ in at least $2^{k-\gamma}$ places is at most 
\begin{align*}
\Pr[|U_{n,k} \cap A_{y^*}| \ge a^*(1+\zeta)] &\le \\
\Pr[| U_{n,k} \cap A_{y^*} | \ge 2^{k-\gamma}] &\le \left(\left(e2^{\gamma-\beta}\right)^{2^{\beta-\gamma}}\right)^{2^{k-\beta}} \\&= \left(e2^{\gamma-\beta}\right)^{2^{k-\gamma}}
\end{align*}
Now we consider a union bound across all $y^*$ which is equivalent to asking the probability that $U_{n,k}$ has fuzzy min-entropy $\gamma$.  That is
\[
\Pr_{U\leftarrow U_{n,k}}[\Hfuzz(U)\ge \gamma] = \left(e2^{\gamma-\beta}\right)^{2^{k-\gamma}}2^n.
\]

The difference between $U_{n,k}$ and $\mathtt{PCode}_{n, k, t, \gamma}^{*}$ is exactly the above probability mass which is removed from the entries of $U_{n,k}$ that are not in $\mathtt{PCode}_{n, k, t, \gamma}^{*}$ and uniformly distributed to the entries in $\mathtt{PCode}_{n, k, t, \gamma}^{*}$.  This means that 
\[
\Delta(U_{n,k}, \mathtt{PCode}_{n, k, t, \gamma}^{*}) \le \left(e2^{\gamma-\beta}\right)^{2^{k-\gamma}}2^n,
\]
completing the proof of Lemma~\ref{lem:close family}.
\end{proof}

